<?xml version="1.0"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
     which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs),
     please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
     (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<?rfc tocappendix="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="3"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<?rfc comments="no" ?>
<?rfc inline="yes" ?>
<rfc category="exp" docName="draft-muks-dnsop-opportunistic-refresh-00" ipr="trust200902">

  <front>

    <title>Opportunistic refresh for DNS resolvers</title>

    <author fullname="Shane Kerr" initials="S." surname="Kerr">
      <organization>Beijing Internet Institute</organization>
      <address>
        <postal>
          <street>2/F, Building 5, No.58 Jinghai Road, BDA</street>
          <city>Beijing</city>
          <code>100176</code>
          <country>CN</country>
        </postal>
        <email>shane@biigroup.cn</email>
        <uri>http://www.biigroup.com/</uri>
      </address>
    </author>

    <author fullname="Stephen Morris" initials="S." surname="Morris">
      <organization>Internet Systems Consortium</organization>
      <address>
        <postal>
          <street>950 Charter Street</street>
          <city>Redwood City</city>
          <code>94063</code>
          <region>CA</region>
          <country>US</country>
        </postal>
        <email>stephen@isc.org</email>
        <uri>http://www.isc.org/</uri>
      </address>
    </author>

    <author fullname="Mukund Sivaraman" initials="M." surname="Sivaraman">
      <organization>Internet Systems Consortium</organization>
      <address>
        <postal>
          <street>950 Charter Street</street>
          <city>Redwood City</city>
          <code>94063</code>
          <region>CA</region>
          <country>US</country>
        </postal>
        <email>muks@mukund.org</email>
        <uri>http://www.isc.org/</uri>
      </address>
    </author>

    <date/>

    <!-- Meta-data Declarations -->

    <area>Operations and Management Area</area>
    <workgroup>Internet Engineering Task Force</workgroup>

    <!-- <keyword>dns</keyword> -->

    <abstract>
      <t>This document describes a mechanism using which a DNS resolver
      can receive information about the freshness of a zone's cached
      records from an authoritative server, and can opportunistically
      refresh TTLs of all of the zone's cached records without making
      additional queries per each record over the network to refresh
      expired records. Using this mechanism can also reduce the workload
      of authoritative servers in constructing replies for refresh
      queries, and the risk of losing such replies across the
      network.</t>
    </abstract>

  </front>

  <middle>

    <section title="Introduction">
      <t>DNS secondary nameservers use the value in a zone's SOA RR's
      SERIAL field to determine freshness of the copy of the zone that
      they are maintaining locally, and establish if a zone transfer to
      update the zone is necessary. Typically they perform this through
      SOA refresh timeout or the NOTIFY mechanism, when they compare the
      SOA SERIAL value from the local copy of a zone against the SOA
      SERIAL value from a remote primary nameserver, and perform a zone
      transfer if the serial number comparison <xref target="RFC1982" />
      establishes that a zone transfer is necessary. By using the SERIAL
      field, nameservers avoid redundant and unnecessary zone transfers
      for local data that is already fresh, thereby reducing network
      traffic and nameserver resource usage.</t>
    </section>

    <section title="Client and server behavior" anchor="sec-behavior">
    </section>

    <section title="The ZONE EDNS(0) option" anchor="sec-format">

      <t>ZONE is an EDNS(0) <xref target="RFC6891" /> option that is
      used to transmit information about a zone. Client and server
      behavior are described in <xref target="sec-behavior" />. In this
      section, the option's syntax is provided.</t>

      <section title="Wire format">

        <t>The following describes the wire format of the OPTION-DATA
        field <xref target="RFC6891" /> of the ZONE EDNS option. All
        ZONE option fields must be represented in network byte
        order.</t>

        <texttable>

          <ttcol>Option field</ttcol>
          <ttcol>Type</ttcol>
          <ttcol>Field size</ttcol>

          <c>SERIAL</c>
          <c>32-bit unsigned integer</c>
          <c>4 octets</c>

          <c>ZONENAME</c>
          <c>DNS name <xref target="RFC1035" /></c>
          <c>Variable length</c>

        </texttable>

      </section>

      <section title="Option fields">
        <section title="SERIAL">
          <t>The SERIAL field is represented as a 32-bit unsigned
          integer in network byte order. TBD.</t>
        </section>
        <section title="ZONENAME">
          <t>The ZONENAME field contains the name of the zone which
          contains the authoritative answer for the question. TBD.</t>
        </section>
      </section>
      <section title="Presentation format">
        <t>As with other EDNS(0) options, the ZONE EDNS option does not
        have a presentation format.</t>
      </section>
    </section>

    <section title="Security considerations" anchor="sec-security">
      <t>A DNS resolver MUST verify that the ZONENAME field in replies
      corresponds to the current zone cut that the resolver has
      determined when contacting the nameserver during the resolution
      process. This field is provided by the nameserver as a hint to the
      client for use in cases where the zone cuts cannot be determined
      without additional queries to the nameserver, such as when a
      hierarchy of zones are served by the same nameserver. The DNS
      resolver MUST check that this field contains either the determined
      zone cut, or is a child of the zone cut but is equal to or a
      super-domain of the name in the question.</t>
    </section>

    <section title="IANA considerations">
      <t>This document defines a new EDNS(0) option, titled ZONE (see
      <xref target="sec-format" />), assigned a value of &lt;TBD&gt;
      from the DNS EDNS0 Option Codes (OPT) space [to be removed upon
      publication:
      https://www.iana.org/assignments/dns-parameters/dns-parameters.xhtml#dns-parameters-11].</t>

      <texttable>

        <ttcol>Value</ttcol>
        <ttcol>Name</ttcol>
        <ttcol>Status</ttcol>
        <ttcol>Reference</ttcol>

        <c>TBD</c>
        <c>ZONE</c>
        <c>TBD</c>
        <c>[draft-muks-dnsop-opportunistic-refresh]</c>

      </texttable>
    </section>

    <section title="Acknowledgements">
      <t>The idea was first discussed by Shane and Mukund during IETF-94
      where various advantages of using such a scheme were
      discovered. During the same IETF meeting, the scheme was verbally
      described to and discussed with Ray Bellis, Geoff Huston and
      George Michaelson from which the scheme was refined. After the
      IETF meeting, initial drafts of the idea were reviewed by Cathy
      Almond, Mark Andrews, Ray Bellis, Evan Hunt and Witold
      Krecicki. Stephen joined as an author after suggesting changes to
      improve presentation of the ideas and alternate schemes.</t>

      <t>Ray Bellis pointed to a dnsop mailing list thread where a
      similar idea was considered by Bob Harold in reply to discussion
      about <xref target="I-D.yao-dnsop-root-cache" /> on 28 October
      2015.</t>
    </section>

  </middle>

  <back>

    <references title="Normative references">
      <?rfc include="reference.RFC.1035.xml"?>
      <?rfc include="reference.RFC.1982.xml"?>
      <?rfc include="reference.RFC.6891.xml"?>
    </references>

    <references title="Informative references">
      <?rfc include="reference.RFC.2308.xml"?>
      <?rfc include="reference.I-D.yao-dnsop-root-cache.xml"?>
    </references>

    <section title="Open issues (to be removed before publication)">
      <t>
        <list style="symbols">

          <t>Stephen: An alternate scheme is proposed, that includes the
          SOA RR in the additional section of every reply and doesn't
          use the EDNS option. If a nameserver doesn't maintain the SOA
          serial, it doesn't include the SOA RR. A client doesn't
          process SOA RRs for this scheme from negative answers <xref
          target="RFC2308" />. Some advantages of using the EDNS option
          are not available with this scheme.</t>

          <t>Ray: one thing you may have to consider is NS record
          handling - there's an issue where a resolver always talks to a
          child without ever referring back to the parent NS perpetually
          prolonging the TTL of NS records learned from the child can
          permit phantom zones (where the zone may have been turned off,
          or had parent NS changes, but the resolver doesn't notice)</t>

          <t>The behavior of when DNSSEC re-validation may be avoided
          should be described precisely.</t>

        </list>
      </t>
    </section>

    <section title="Change history (to be removed before publication)">
      <t>
        <list style="symbols">

          <t>
          draft-muks-dnsop-opportunistic-refresh-00
          <vspace/>
          Initial draft.
          </t>

        </list>
      </t>
    </section>

  </back>
</rfc>
